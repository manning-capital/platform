<div class="live-trades">
  <header class="page-header">
    <h1>Live Trades Monitor</h1>
    <p class="subtitle">Real-time monitoring of active positions and trade execution</p>
  </header>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="filter-group">
        <label class="filter-label">Search Symbol</label>
        <input 
          type="text" 
          class="filter-input"
          placeholder="e.g., AAPL"
          [value]="searchTerm()"
          (input)="onSearchChange($any($event.target).value)">
      </div>

      <div class="filter-group">
        <label class="filter-label">From Date</label>
        <input 
          type="date" 
          class="filter-input"
          [value]="formatDateForInput(startDate())"
          (change)="onStartDateChange($any($event.target).value)">
      </div>

      <div class="filter-group">
        <label class="filter-label">To Date</label>
        <input 
          type="date" 
          class="filter-input"
          [value]="formatDateForInput(endDate())"
          (change)="onEndDateChange($any($event.target).value)">
      </div>

      <div class="filter-group">
        <label class="filter-label">Status</label>
        <select 
          class="filter-select"
          [value]="filterStatus()"
          (change)="onFilterStatusChange($any($event.target).value)">
          <option value="ALL">All</option>
          <option value="OPEN">Open</option>
          <option value="CLOSED">Closed</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Side</label>
        <select 
          class="filter-select"
          [value]="filterSide()"
          (change)="onFilterSideChange($any($event.target).value)">
          <option value="ALL">All</option>
          <option value="BUY">Buy</option>
          <option value="SELL">Sell</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Model</label>
        <select 
          class="filter-select"
          [value]="filterModel()"
          (change)="onFilterModelChange($any($event.target).value)">
          <option value="ALL">All Models</option>
          @for (model of models(); track model.id) {
            <option [value]="model.id">{{ model.name }}</option>
          }
        </select>
      </div>

      <button class="clear-filters-btn" (click)="clearFilters()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
        Clear
      </button>
    </div>

    <div class="filter-results">
      Showing {{ paginatedTrades().length }} of {{ filteredTrades().length }} trades (Open positions always shown)
    </div>
  </div>

  <!-- Master-Detail Layout -->
  <div class="master-detail-container">
    <!-- Trade List (Left Pane) -->
    <div class="trade-list">
      
      <div class="trade-list-items">
        @for (trade of allTradesForList(); track trade.id) {
          <div 
            class="trade-list-item"
            [class.active]="isTradeSelected(trade)"
            [class.closed]="trade.status === 'CLOSED'"
            (click)="selectTrade(trade)">
            <div class="trade-list-item-header">
              <div class="trade-symbol">{{ trade.symbol }}</div>
              <span class="side-badge small" [class.buy]="trade.side === 'BUY'" 
                    [class.sell]="trade.side === 'SELL'">
                {{ trade.side }}
              </span>
            </div>
            <div class="trade-list-item-body">
              <div class="trade-model-name">{{ getModelName(trade.modelId) }}</div>
              <div class="trade-pnl" [class.positive]="trade.pnl >= 0" [class.negative]="trade.pnl < 0">
                {{ formatCurrency(trade.pnl) }}
              </div>
            </div>
            <div class="trade-list-item-footer">
              <span class="trade-time">{{ formatTime(trade.timestamp) }}</span>
              @if (trade.status === 'OPEN') {
                <span class="status-indicator open">LIVE</span>
              } @else {
                <span class="status-indicator closed">CLOSED</span>
              }
            </div>
          </div>
        } @empty {
          <div class="empty-list">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
            </svg>
            <p>No trades available</p>
          </div>
        }
      </div>

      <!-- Pagination Controls -->
      @if (totalPages() > 1) {
        <div class="pagination">
          <button 
            class="page-btn"
            [disabled]="currentPage() === 1"
            (click)="previousPage()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
          </button>

          @for (page of pageNumbers; track page) {
            @if (page === -1) {
              <span class="page-ellipsis">...</span>
            } @else {
              <button 
                class="page-btn"
                [class.active]="currentPage() === page"
                (click)="goToPage(page)">
                {{ page }}
              </button>
            }
          }

          <button 
            class="page-btn"
            [disabled]="currentPage() === totalPages()"
            (click)="nextPage()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
            </svg>
          </button>
        </div>
      }
    </div>

    <!-- Trade Detail (Right Pane) -->
    @if (selectedTrade(); as trade) {
      <div class="trade-detail">
        <div class="trade-detail-header">
          <div class="detail-header-left">
            <h2 class="detail-symbol">{{ trade.symbol }}</h2>
            <span class="side-badge large" [class.buy]="trade.side === 'BUY'" 
                  [class.sell]="trade.side === 'SELL'">
              {{ trade.side }}
            </span>
            @if (trade.status === 'OPEN') {
              <span class="live-badge">LIVE</span>
            } @else {
              <span class="closed-badge">CLOSED</span>
            }
          </div>
          <div class="detail-header-right">
            <div class="detail-pnl" [class.positive]="trade.pnl >= 0" [class.negative]="trade.pnl < 0">
              <div class="pnl-amount">{{ formatCurrency(trade.pnl) }}</div>
              <div class="pnl-percent">{{ formatPercent(trade.pnlPercent) }}</div>
            </div>
          </div>
        </div>

        <div class="detail-sections">
          <!-- Metrics and Conditions (Priority Section) -->
          <section class="detail-section metrics-section">
            <app-trade-metrics [metrics]="tradeMetrics()"></app-trade-metrics>
          </section>

          <!-- Performance Metrics -->
          <section class="detail-section">
            <h3 class="section-title">Performance Metrics</h3>
            <div class="metrics-cards">
              <div class="metric-card" [class.positive]="trade.pnl >= 0" [class.negative]="trade.pnl < 0">
                <div class="metric-card-label">Profit & Loss</div>
                <div class="metric-card-value">{{ formatCurrency(trade.pnl) }}</div>
                <div class="metric-card-subtitle">{{ formatPercent(trade.pnlPercent) }}</div>
              </div>
              <div class="metric-card">
                <div class="metric-card-label">Position Value</div>
                <div class="metric-card-value">{{ formatCurrency(trade.currentPrice * trade.quantity) }}</div>
                <div class="metric-card-subtitle">{{ trade.quantity }} shares</div>
              </div>
              <div class="metric-card">
                <div class="metric-card-label">Cost Basis</div>
                <div class="metric-card-value">{{ formatCurrency(trade.entryPrice * trade.quantity) }}</div>
                <div class="metric-card-subtitle">Initial investment</div>
              </div>
            </div>
          </section>

          <!-- Trade Information -->
          <section class="detail-section">
            <h3 class="section-title">Trade Information</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Model</span>
                <span class="detail-value">{{ getModelName(trade.modelId) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status</span>
                <span class="detail-value">{{ trade.status }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Quantity</span>
                <span class="detail-value">{{ trade.quantity }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Entry Time</span>
                <span class="detail-value">{{ formatDate(trade.timestamp) }}</span>
              </div>
            </div>
          </section>

          <!-- Price Information -->
          <section class="detail-section">
            <h3 class="section-title">Price Information</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Entry Price</span>
                <span class="detail-value highlight">{{ formatCurrency(trade.entryPrice) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Current Price</span>
                <span class="detail-value highlight current-price">{{ formatCurrency(trade.currentPrice) }}</span>
              </div>
              @if (trade.exitPrice) {
                <div class="detail-item">
                  <span class="detail-label">Exit Price</span>
                  <span class="detail-value highlight">{{ formatCurrency(trade.exitPrice) }}</span>
                </div>
              }
              <div class="detail-item">
                <span class="detail-label">Price Change</span>
                <span class="detail-value" [class.positive]="trade.currentPrice >= trade.entryPrice" 
                      [class.negative]="trade.currentPrice < trade.entryPrice">
                  {{ formatCurrency(trade.currentPrice - trade.entryPrice) }}
                </span>
              </div>
            </div>
          </section>
        </div>
      </div>
    } @else {
      <div class="trade-detail trade-detail-empty">
        <div class="empty-detail">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
          </svg>
          <h3>No Trade Selected</h3>
          <p>Select a trade from the list to view details</p>
        </div>
      </div>
    }
  </div>
</div>
